<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="K3nX">





<title> Traceback </title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


    


<meta name="generator" content="Hexo 4.2.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">K3nX</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">K3nX</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Traceback</h1>
            
                <div class="post-meta">
                    

                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/Hackthebox/">Hackthebox</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h3 id="Traceback-K3nX"><a href="#Traceback-K3nX" class="headerlink" title="Traceback - K3nX"></a>Traceback - K3nX</h3><ul>
<li>This Machine Ip is 10.10.10.181<br><img src="1.png" alt="Sample Image"></li>
</ul>
<h3 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h3><pre><code class="bash"># nmap -sSV -O -A 10.10.10.181
  PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDbMNfxYPZGAdOf2OAbwXhXDi43/QOeh5OwK7Me/l15Bej9yfkZwuLhyslDCYIvi4fh/2ZxB0MecNYHM+Sf4xR/CqPgIjQ+NuyAPI/c9iXDDhzJ+HShRR5WIqsqBHwtsQFrcQXcfQFYlC+NFj5ro9wfl2+UvDO6srTUxl+GaaabePYm2u0mlmfwHqlaQaB8HOUb436IdavyTdvpW7LTz4qKASrCTPaawigDymMEQTRYXY4vSemIGMD1JbfpErh0mrFt0Hu12dmL6LrqNmUcbakxOXvZATisHU5TloxqH/p2iWJSwFi/g0YyR2JZnIB65fGTLjIhZsOohtSG7vrPk+cZ
|   256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBD2jCEklOC94CKIBj9Lguh3lmTWDFYq41QkI5AtFSx7x+8uOCGaFTqTwphwmfkwZTHL1pzOMoJTrGAN8T7LA2j0=
|   256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIL4LOW9SgPQeTZubVmd+RsoO3fhSjRSWjps7UtHOc10p
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.29 ((Ubuntu))
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Help us
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.80%E=4%D=3/24%OT=22%CT=1%CU=37784%PV=Y%DS=2%DC=T%G=Y%TM=5E7A159
OS:D%P=x86_64-pc-linux-gnu)SEQ(SP=107%GCD=1%ISR=109%TI=Z%CI=Z%II=I%TS=A)OPS
OS:(O1=M54DST11NW7%O2=M54DST11NW7%O3=M54DNNT11NW7%O4=M54DST11NW7%O5=M54DST1
OS:1NW7%O6=M54DST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)ECN
OS:(R=Y%DF=Y%T=40%W=7210%O=M54DNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=A
OS:S%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R
OS:=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F
OS:=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%
OS:T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD
OS:=S)

Uptime guess: 26.594 days (since Thu Feb 27 06:28:45 2020)
Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=263 (Good luck!)
IP ID Sequence Generation: All zeros
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 21/tcp)
HOP RTT       ADDRESS
1   294.13 ms 10.10.14.1
2   293.05 ms 10.10.10.181</code></pre>
<p>As nmap result port 22 (ssh) and port 80 (apache httpd) are open</p>
<h3 id="Web-Enumeration"><a href="#Web-Enumeration" class="headerlink" title="Web Enumeration"></a>Web Enumeration</h3><ul>
<li><p>I see this web page , This Web have a backdoor but I don’t know what backdoor is this. In this time I check page source code<br><img src="2.png" alt="Sample Image"></p>
</li>
<li><p>I found some command in source code , This command show a backdoor in this website is webshell.<br><img src="3_1.png" alt="Sample Image"></p>
</li>
<li><p>I found one name in this index , name is Xh4H , I use google to find this name and webshell , Ohh I found one github repo name with webshell  owner is Xh4h<br><a href="https://github.com/Xh4H/Web-Shells" target="_blank" rel="noopener">https://github.com/Xh4H/Web-Shells</a><br><img src="4.png" alt="Sample Image"></p>
</li>
<li><p>I made a simple wordlist list with this webshell name<br><img src="5.png" alt="Sample Image"></p>
</li>
<li><p>I wrote bash script to find backdoor webshell</p>
<pre><code class="bash"># cat admin.sh
#!/bin/bash
read -p &quot;Enter  Url: &quot; mainurl
for x in $(cat admnpage.txt)
do
  echo &quot;[*]finding ${mainurl}/${x}...&quot;
  if [ $(curl -A &quot;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:70.0) Gecko/20100101 Firefox/70.0&quot; &quot;${mainurl}/${x}&quot; -I 2&gt;/dev/null | grep &quot;HTTP/1.1&quot; | awk &#39;{print $2}&#39; | tail -n 1) -eq 200 ]
  then
      echo &quot;[x] ${mainurl}/${x} Found&quot;
  fi
 done</code></pre>
</li>
<li><p>I run my script</p>
</li>
<li><p>Finally I found backdoor webshell. Name is smevk.php<br><img src="6.png" alt="Sample Image"></p>
</li>
<li><p>I login with admin:admin into this webshell<br><img src="7.png" alt="Sample Image"></p>
<h3 id="Getting-Low-Priv-Shell"><a href="#Getting-Low-Priv-Shell" class="headerlink" title="Getting Low Priv Shell"></a>Getting Low Priv Shell</h3></li>
<li><p>In this webshell we can upload our shell.So I create one shell with msfvenom<br><img src="8.png" alt="Sample Image"></p>
</li>
<li><p>After uploading and run I got one meterpreter Shell<br><img src="9.png" alt="Sample Image"></p>
</li>
<li><p>I got this meterpreter shell as webadmin</p>
</li>
<li><p>I use ssh-keygen command to generate ssh key and</p>
</li>
<li><p>I add my public key into authorized_key of webadmin<br><img src="10.png" alt="Sample Image"></p>
</li>
<li><p>After this I can get ssh access with webadmin<br><img src="11.png" alt="Sample Image"></p>
</li>
</ul>
<h3 id="User"><a href="#User" class="headerlink" title="User"></a>User</h3><ul>
<li><p>I use sudo -l to see the special permission we have, which is to run the luvit program as sysadmin</p>
</li>
<li><p>In this time I think sysadmin is higher priv user than webadmin ,</p>
</li>
<li><p>Luvit is a program to execute code written in lua, and always in the home there is a key.lua file, containing a portion of code that allows you to add any public key into the authorized keys of sysadmin.</p>
</li>
<li><p>I create lua script file to add my public key to authorized_key of sysadmin<br><img src="12.png" alt="Sample Image"></p>
</li>
<li><p>I run this lua script<br>Command is sudo -u sysadmin /home/sysadmin/luvit blah.lua<br><img src="13.png" alt="Sample Image"></p>
</li>
<li><p>Finally I got ssh access as sysadmin</p>
</li>
<li><p>I got user flag into<br><img src="14.png" alt="Sample Image"></p>
</li>
</ul>
<h3 id="Privileges-Escalation-into-root"><a href="#Privileges-Escalation-into-root" class="headerlink" title="Privileges Escalation into root"></a>Privileges Escalation into root</h3><ul>
<li>I upload pspy tool into this machine and i run this to see process </li>
<li>I this time I found one process running with root</li>
<li>This is motd process ( Message of the day).It copies from the backups folder inside etc/update-motd.d (default folder)<br><img src="15.png" alt="Sample Image"></li>
</ul>
<ul>
<li><p>I go into /etc/update-motd.d, we should notice that we can edit the files, such as the header. Since it will be run as root, it will be sufficient to print our flag (you have to be quick because every 30 seconds the file will be overwritten and therefore our changes will be lost).</p>
</li>
<li><p>I added cat /root/root.txt command using echo into 00-header file<br><img src="16.png" alt="Sample Image"></p>
</li>
</ul>
<ul>
<li>In other windows of my terminal</li>
<img src="root.png" alt="Sample Image">
<li>Finally I got root flag </li>
</ul>
        </div>

        
            <section class="post-copyright">
                
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright K3nX (c) 2019</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span></span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/Hackthebox/"># Hackthebox</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/">/</a>
            
            
            <a class="next" rel="next" href="/hackthebox/machines/OpenKeyS">OpenKeyS</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© K3nX </span>
    </div>
</footer>

    </div>
</body>
</html>
